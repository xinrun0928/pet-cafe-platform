env:
    APPLICATION_NAME: springbootx9rzc
    VERSION: k8s-latest

name: æ„å»ºk8s springbootx9rzc
run-name: ${{ github.actor }} æ­£åœ¨æ„å»º k8s springbootx9rzc æœåŠ¡ ğŸš€

on:
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            -   run: echo "ğŸ” åœ¨ä»“åº“ ${{ github.repository }} çš„åˆ†æ”¯ä¸ºï¼š${{ github.ref }} è§¦å‘äº† ${{ github.event_name }} äº‹ä»¶."
            -   name: æ£€å‡ºä»£ç åˆ° Github Actions è¿è¡Œå®¹å™¨
                uses: actions/checkout@v4
            -   name: åˆ—ä¸¾å½“å‰æœåŠ¡ä¸‹çš„æ–‡ä»¶ç›®å½•ç»“æ„
                run: |
                    ls
            -   name: å‘å®¹å™¨å®‰è£… Java 8 (JDK 8) è¿è¡Œç¯å¢ƒ
                uses: actions/setup-java@v4
                with:
                    java-version: '8'
                    distribution: 'temurin'
                    architecture: x64
            -   name: ç¼“å­˜ MAVEN ä¾èµ–é¡¹
                run: |
                    cd springbootx9rzc
                    mvn --batch-mode --update-snapshots verify
            # ç¼–è¯‘æ‰“åŒ…
            -   name: æ‰§è¡Œ MAVEN æ‰“åŒ…å‘½ä»¤ï¼Œè·³è¿‡æµ‹è¯•ä»£ç 
                run: |
                    cd springbootx9rzc
                    mvn clean package -Dmaven.test.skip=true
            -   name: å†æ¬¡åˆ—ä¸¾å½“å‰æœåŠ¡ä¸‹æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ç»“æ„
                run: |
                    ls ${{ env.APPLICATION_NAME }}
            -   name: ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
                run: ${{ secrets.DOCKER_LOGIN }}
            -   name: æ„å»º springbootx9rzc é•œåƒ
                run: |
                    docker build -t ${{ secrets.DOCKER_REGISTRY }}/${{ secrets.NAMESPACE }}/${{ env.APPLICATION_NAME }}:${{ env.VERSION }} -f "springbootx9rzc/k8s/Dockerfile" ./
            -   name: æ¨é€ springbootx9rzc é•œåƒ
                run: |
                    docker push ${{ secrets.DOCKER_REGISTRY }}/${{ secrets.NAMESPACE }}/${{ env.APPLICATION_NAME }}:${{ env.VERSION }}
